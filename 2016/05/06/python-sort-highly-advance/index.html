<!doctype html><html class="theme-next mist use-motion"><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1"><meta http-equiv=Cache-Control content=no-transform><meta http-equiv=Cache-Control content=no-siteapp><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel=stylesheet type=text/css><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel=stylesheet type=text/css><link href="/css/main.css?v=5.0.1" rel=stylesheet type=text/css><meta name=keywords content=python,><link rel=alternate href=/atom.xml title="Vito's TecH sTacK" type=application/atom+xml><link rel="shortcut icon" type=image/x-icon href="/favicon.ico?v=5.0.1"><meta name=description content="基础货Python list内置sort()方法用来排序，也可以用python内置的全局sorted()方法来对可迭代的序列排序生成新的序列。 排序基础简单的升序排序是非常容易的。只需要调用sorted()方法。它返回一个新的list，新的list的元素基于小于运算符__lt__来排序。12&amp;gt;&amp;gt;&amp;gt; sorted([5, 2, 3, 1, 4])[1, 2, 3, 4, 5] 你也"><meta property=og:type content=article><meta property=og:title content="python排序sort sorted高级排序技巧"><meta property=og:url content=http://www.vitostack.com/2016/05/06/python-sort-highly-advance/index.html><meta property=og:site_name content="Vito's TecH sTacK"><meta property=og:description content="基础货Python list内置sort()方法用来排序，也可以用python内置的全局sorted()方法来对可迭代的序列排序生成新的序列。 排序基础简单的升序排序是非常容易的。只需要调用sorted()方法。它返回一个新的list，新的list的元素基于小于运算符__lt__来排序。12&amp;gt;&amp;gt;&amp;gt; sorted([5, 2, 3, 1, 4])[1, 2, 3, 4, 5] 你也"><meta property=og:updated_time content=2016-05-06T15:06:47.000Z><meta name=twitter:card content=summary><meta name=twitter:title content="python排序sort sorted高级排序技巧"><meta name=twitter:description content="基础货Python list内置sort()方法用来排序，也可以用python内置的全局sorted()方法来对可迭代的序列排序生成新的序列。 排序基础简单的升序排序是非常容易的。只需要调用sorted()方法。它返回一个新的list，新的list的元素基于小于运算符__lt__来排序。12&amp;gt;&amp;gt;&amp;gt; sorted([5, 2, 3, 1, 4])[1, 2, 3, 4, 5] 你也"><script type=text/javascript id=hexo.configuration>
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Vito'
    }
  };
</script><title>python排序sort sorted高级排序技巧 | Vito's TecH sTacK</title></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-Hans><script type=text/javascript>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8eda41252a1f0cf391f04b5f74662966";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><div class="container one-collumn sidebar-position-left page-post-detail"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-meta><div class=custom-logo-site-title><a href="/" class=brand rel=start><span class=logo-line-before><i></i></span> <span class=site-title>Vito's TecH sTacK</span> <span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>Life is short, why you become a developer?</p></div><div class=site-nav-toggle><button><span class=btn-bar></span> <span class=btn-bar></span> <span class=btn-bar></span></button></div><nav class=site-nav><ul id=menu class=menu><li class="menu-item menu-item-home"><a href="/" rel=section><i class="menu-item-icon fa fa-home fa-fw"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href=/about rel=section><i class="menu-item-icon fa fa-user fa-fw"></i><br>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives rel=section><i class="menu-item-icon fa fa-archive fa-fw"></i><br>归档</a></li><li class="menu-item menu-item-tags"><a href=/tags rel=section><i class="menu-item-icon fa fa-tags fa-fw"></i><br>标签</a></li><li class="menu-item menu-item-guestbook"><a href=/guestbook rel=section><i class="menu-item-icon fa fa-comments fa-fw"></i><br>留言</a></li><li class="menu-item menu-item-search"><a href=# class=st-search-show-outputs><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><form class=site-search-form><input type=text id=st-search-input class="st-search-input st-default-search-input"></form><script type=text/javascript>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'dJNuMs9b_-xzwsco9iLM','2.0.0');
</script></div></nav></div><a href=https://github.com/Vito2015><img style="position: absolute; top: 0; left: 0; border: 0;" src=https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67 alt="Fork me on GitHub" data-canonical-src=https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png></a></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><div id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">python排序sort sorted高级排序技巧</h1><div class=post-meta><span class=post-time><span class=post-meta-item-icon><i class="fa fa-calendar-o"></i></span> <span class=post-meta-item-text>发表于</span><time itemprop=dateCreated datetime=2016-05-06T12:04:27+08:00 content=2016-05-06>2016-05-06</time></span> <span class=post-category>&nbsp; | &nbsp; <span class=post-meta-item-icon><i class="fa fa-folder-o"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=https://schema.org/Thing><a href="/categories/Python/" itemprop=url rel=index><span itemprop=name>Python</span></a></span></span> <span class=post-comments-count>&nbsp; | &nbsp; <a href=/2016/05/06/python-sort-highly-advance/#comments itemprop=discussionUrl><span class="post-comments-count ds-thread-count" data-thread-key="2016/05/06/python-sort-highly-advance/" itemprop=commentsCount></span></a></span> <span id="/2016/05/06/python-sort-highly-advance/" class=leancloud_visitors data-flag-title="python排序sort sorted高级排序技巧">&nbsp; | &nbsp; <span class=post-meta-item-icon><i class="fa fa-eye"></i></span> <span class=post-meta-item-text>阅读次数</span> <span class=leancloud-visitors-count></span></span> &nbsp; | &nbsp; <span class=page-pv><i class="fa fa-file-o"></i> <span class=busuanzi-value id=busuanzi_value_page_pv></span></span></div></header><div class=post-body itemprop=articleBody><h2 id=基础货><a href=#基础货 class=headerlink title=基础货></a>基础货</h2><p>Python <code>list</code>内置<code>sort()</code>方法用来排序，也可以用python内置的全局<code>sorted()</code>方法来对可迭代的序列排序生成新的序列。</p><h3 id=排序基础><a href=#排序基础 class=headerlink title=排序基础></a>排序基础</h3><p>简单的升序排序是非常容易的。只需要调用<code>sorted()</code>方法。它返回一个新的<code>list</code>，新的<code>list</code>的元素基于小于运算符<code>__lt__</code>来排序。<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted([<span class=number>5</span>, <span class=number>2</span>, <span class=number>3</span>, <span class=number>1</span>, <span class=number>4</span>])</span><br><span class=line>[<span class=number>1</span>, <span class=number>2</span>, <span class=number>3</span>, <span class=number>4</span>, <span class=number>5</span>]</span><br></pre></td></tr></table></figure></p><p>你也可以使用<code>list.sort()</code>方法来排序，此时<code>list</code>本身将被修改。通常此方法不如<code>sorted()</code>方便，但是如果你不需要保留原来的<code>list</code>，此方法将更有效。<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>a = [<span class=number>5</span>, <span class=number>2</span>, <span class=number>3</span>, <span class=number>1</span>, <span class=number>4</span>]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>a.sort()</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>a</span><br><span class=line>[<span class=number>1</span>, <span class=number>2</span>, <span class=number>3</span>, <span class=number>4</span>, <span class=number>5</span>]</span><br></pre></td></tr></table></figure></p><p>另一个不同就是<code>list.sort()</code>方法仅被定义在<code>list</code>中，相反地<code>sorted()</code>方法对所有的可迭代序列都有效。<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>&gt;&gt;&gt;</span><br><span class=line>sorted(&#123;<span class=number>1</span>: <span class=string>'D'</span>, <span class=number>2</span>: <span class=string>'B'</span>, <span class=number>3</span>: <span class=string>'B'</span>, <span class=number>4</span>: <span class=string>'E'</span>, <span class=number>5</span>: <span class=string>'A'</span>&#125;)</span><br><span class=line>[<span class=number>1</span>, <span class=number>2</span>, <span class=number>3</span>, <span class=number>4</span>, <span class=number>5</span>]</span><br></pre></td></tr></table></figure></p><h3 id=key参数-函数><a href=#key参数-函数 class=headerlink title=key参数/函数></a>key参数/函数</h3><p>从python2.4开始，<code>list.sort()</code>和<code>sorted()</code>函数增加了<code>key</code>参数来指定一个函数，此函数将在每个元素比较前被调用。 例如通过<code>key</code>指定的函数来忽略字符串的大小写：</p><a id=more></a><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(<span class=string>"This is a test string from Andrew"</span>.split(), key=str.lower)</span><br><span class=line>[<span class=string>'a'</span>, <span class=string>'Andrew'</span>, <span class=string>'from'</span>, <span class=string>'is'</span>, <span class=string>'string'</span>, <span class=string>'test'</span>, <span class=string>'This'</span>]</span><br></pre></td></tr></table></figure><p><code>key</code>参数的值为一个函数，此函数只有一个参数且返回一个值用来进行比较。这个技术是快速的因为key指定的函数将准确地对每个元素调用。<br>更广泛的使用情况是用复杂对象的某些值来对复杂对象的序列排序，例如：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>student_tuples = [</span><br><span class=line>        (<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>),</span><br><span class=line>        (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>),</span><br><span class=line>        (<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>),</span><br><span class=line>]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_tuples, key=<span class=keyword>lambda</span> student: student[<span class=number>2</span>])   <span class=comment># sort by age</span></span><br><span class=line>[(<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>)]</span><br></pre></td></tr></table></figure></p><p>同样的技术对拥有命名属性的复杂对象也适用，例如：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span><span class=class><span class=keyword>class</span> <span class=title>Student</span>:</span></span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__init__</span><span class=params>(self, name, grade, age)</span>:</span></span><br><span class=line>                self.name = name</span><br><span class=line>                self.grade = grade</span><br><span class=line>                self.age = age</span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__repr__</span><span class=params>(self)</span>:</span></span><br><span class=line>                <span class=keyword>return</span> repr((self.name, self.grade, self.age))</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>student_objects = [</span><br><span class=line>        Student(<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>),</span><br><span class=line>        Student(<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>),</span><br><span class=line>        Student(<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>),</span><br><span class=line>]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_objects, key=<span class=keyword>lambda</span> student: student.age)   <span class=comment># sort by age</span></span><br><span class=line>[(<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>)]</span><br></pre></td></tr></table></figure></p><h2 id=高级技巧><a href=#高级技巧 class=headerlink title=高级技巧></a>高级技巧</h2><h3 id=Operator-模块函数><a href=#Operator-模块函数 class=headerlink title="Operator 模块函数"></a>Operator 模块函数</h3><p>上面的<code>key</code>参数的使用非常广泛，因此python提供了一些方便的函数来使得访问方法更加容易和快速。<code>operator</code>模块有<code>itemgetter</code>，<code>attrgetter</code>，从2.6开始还增加了<code>methodcaller</code>方法。使用这些方法，上面的操作将变得更加简洁和快速：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span><span class=keyword>from</span> operator <span class=keyword>import</span> itemgetter, attrgetter</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_tuples, key=itemgetter(<span class=number>2</span>))</span><br><span class=line>[(<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>)]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_objects, key=attrgetter(<span class=string>'age'</span>))</span><br><span class=line>[(<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>)]</span><br></pre></td></tr></table></figure></p><p><code>operator</code>模块还允许多级的排序，例如，先以<code>grade</code>，然后再以<code>age</code>来排序：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_tuples, key=itemgetter(<span class=number>1</span>,<span class=number>2</span>))</span><br><span class=line>[(<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>), (<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>)]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_objects, key=attrgetter(<span class=string>'grade'</span>, <span class=string>'age'</span>))</span><br><span class=line>[(<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>), (<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>)]</span><br></pre></td></tr></table></figure><h3 id=升序和降序><a href=#升序和降序 class=headerlink title=升序和降序></a>升序和降序</h3><p><code>list.sort()</code>和<code>sorted()</code>都接受一个参数<code>reverse（True or False）</code>来表示升序或降序排序。例如对上面的<code>student</code>降序排序如下：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_tuples, key=itemgetter(<span class=number>2</span>), reverse=<span class=keyword>True</span>)</span><br><span class=line>[(<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>)]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_objects, key=attrgetter(<span class=string>'age'</span>), reverse=<span class=keyword>True</span>)</span><br><span class=line>[(<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>)]</span><br></pre></td></tr></table></figure></p><h3 id=排序的稳定性和复杂排序><a href=#排序的稳定性和复杂排序 class=headerlink title=排序的稳定性和复杂排序></a>排序的稳定性和复杂排序</h3><p>从python2.2开始，排序被保证为稳定的。意思是说多个元素如果有相同的<code>key</code>，则排序前后他们的先后顺序不变。<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>data = [(<span class=string>'red'</span>, <span class=number>1</span>), (<span class=string>'blue'</span>, <span class=number>1</span>), (<span class=string>'red'</span>, <span class=number>2</span>), (<span class=string>'blue'</span>, <span class=number>2</span>)]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(data, key=itemgetter(<span class=number>0</span>))</span><br><span class=line>[(<span class=string>'blue'</span>, <span class=number>1</span>), (<span class=string>'blue'</span>, <span class=number>2</span>), (<span class=string>'red'</span>, <span class=number>1</span>), (<span class=string>'red'</span>, <span class=number>2</span>)]</span><br></pre></td></tr></table></figure></p><p>注意在排序后<code>&#39;blue&#39;</code>的顺序被保持了，即<code>&#39;blue&#39;</code>, <code>1</code>在<code>&#39;blue&#39;</code>, <code>2</code>的前面。</p><p>更复杂地你可以构建多个步骤来进行更复杂的排序，例如对<code>student</code>数据先以<code>grade</code>降序排列，然后再以<code>age</code>升序排列。<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>s = sorted(student_objects, key=attrgetter(<span class=string>'age'</span>))     <span class=comment># sort on secondary key</span></span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(s, key=attrgetter(<span class=string>'grade'</span>), reverse=<span class=keyword>True</span>)       <span class=comment># now sort on primary key, descending</span></span><br><span class=line>[(<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>)]</span><br></pre></td></tr></table></figure></p><h2 id=最老土的排序方法-DSU><a href=#最老土的排序方法-DSU class=headerlink title=最老土的排序方法-DSU></a>最老土的排序方法-DSU</h2><p>我们称其为DSU（Decorate-Sort-Undecorate）,原因为排序的过程需要下列三步：</p><ol><li>对原始的list进行装饰，使得新list的值可以用来控制排序；</li></ol><ul><li>对装饰后的list排序；</li><li>将装饰删除，将排序后的装饰list重新构建为原来类型的list；</li></ul><p>例如，使用DSU方法来对<code>student</code>数据根据<code>grade</code>排序：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>decorated = [(student.grade, i, student) <span class=keyword>for</span> i, student <span class=keyword>in</span> enumerate(student_objects)]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>decorated.sort()</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>[student <span class=keyword>for</span> grade, i, student <span class=keyword>in</span> decorated]               <span class=comment># undecorate</span></span><br><span class=line>[(<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>)]</span><br></pre></td></tr></table></figure></p><p>上面的比较能够工作，原因是<code>tuples</code>是可以用来比较，<code>tuples</code>间的比较首先比较<code>tuples</code>的第一个元素，如果第一个相同再比较第二个元素，以此类推。</p><p>并不是所有的情况下都需要在以上的<code>tuples</code>中包含索引，但是包含索引可以有以下好处：</p><ol><li>排序是稳定的，如果两个元素有相同的key，则他们的原始先后顺序保持不变；</li></ol><ul><li>原始的元素不必用来做比较，因为tuples的第一和第二元素用来比较已经是足够了。</li></ul><p>此方法被RandalL.在perl中广泛推广后，他的另一个名字为也被称为Schwartzian transform。</p><p>对大的list或list的元素计算起来太过复杂的情况下，在python2.4前，DSU很可能是最快的排序方法。但是在2.4之后，上面解释的key函数提供了类似的功能。</p><h2 id=其他语言普遍使用的排序方法-cmp函数><a href=#其他语言普遍使用的排序方法-cmp函数 class=headerlink title=其他语言普遍使用的排序方法-cmp函数></a>其他语言普遍使用的排序方法-cmp函数</h2><p>在python2.4前，<code>sorted()</code>和<code>list.sort()</code>函数没有提供<code>key</code>参数，但是提供了<code>cmp</code>参数来让用户指定比较函数。此方法在其他语言中也普遍存在。<br>在python3.0中，<code>cmp</code>参数被彻底的移除了，从而简化和统一语言，减少了高级比较和<code>__cmp__</code>方法的冲突。<br>在python2.x中<code>cmp</code>参数指定的函数用来进行元素间的比较。此函数需要2个参数，然后返回负数表示小于，0表示等于，正数表示大于。例如：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span><span class=function><span class=keyword>def</span> <span class=title>numeric_compare</span><span class=params>(x, y)</span>:</span></span><br><span class=line>        <span class=keyword>return</span> x - y</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted([<span class=number>5</span>, <span class=number>2</span>, <span class=number>4</span>, <span class=number>1</span>, <span class=number>3</span>], cmp=numeric_compare)</span><br><span class=line>[<span class=number>1</span>, <span class=number>2</span>, <span class=number>3</span>, <span class=number>4</span>, <span class=number>5</span>]</span><br></pre></td></tr></table></figure></p><p>或者你可以反序排序：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span><span class=function><span class=keyword>def</span> <span class=title>reverse_numeric</span><span class=params>(x, y)</span>:</span></span><br><span class=line>        <span class=keyword>return</span> y - x</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted([<span class=number>5</span>, <span class=number>2</span>, <span class=number>4</span>, <span class=number>1</span>, <span class=number>3</span>], cmp=reverse_numeric)</span><br><span class=line>[<span class=number>5</span>, <span class=number>4</span>, <span class=number>3</span>, <span class=number>2</span>, <span class=number>1</span>]</span><br></pre></td></tr></table></figure></p><p>当我们将现有的2.x的代码移植到3.x时，需要将<code>cmp</code>函数转化为<code>key</code>函数，以下的<code>wrapper</code>很有帮助：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br></pre></td><td class=code><pre><span class=line><span class=function><span class=keyword>def</span> <span class=title>cmp_to_key</span><span class=params>(mycmp)</span>:</span></span><br><span class=line>    <span class=string>'Convert a cmp= function into a key= function'</span></span><br><span class=line>    <span class=class><span class=keyword>class</span> <span class=title>K</span><span class=params>(object)</span>:</span></span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__init__</span><span class=params>(self, obj, *args)</span>:</span></span><br><span class=line>            self.obj = obj</span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__lt__</span><span class=params>(self, other)</span>:</span></span><br><span class=line>            <span class=keyword>return</span> mycmp(self.obj, other.obj) &lt; <span class=number>0</span></span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__gt__</span><span class=params>(self, other)</span>:</span></span><br><span class=line>            <span class=keyword>return</span> mycmp(self.obj, other.obj) &gt; <span class=number>0</span></span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__eq__</span><span class=params>(self, other)</span>:</span></span><br><span class=line>            <span class=keyword>return</span> mycmp(self.obj, other.obj) == <span class=number>0</span></span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__le__</span><span class=params>(self, other)</span>:</span></span><br><span class=line>            <span class=keyword>return</span> mycmp(self.obj, other.obj) &lt;= <span class=number>0</span></span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__ge__</span><span class=params>(self, other)</span>:</span></span><br><span class=line>            <span class=keyword>return</span> mycmp(self.obj, other.obj) &gt;= <span class=number>0</span></span><br><span class=line>        <span class=function><span class=keyword>def</span> <span class=title>__ne__</span><span class=params>(self, other)</span>:</span></span><br><span class=line>            <span class=keyword>return</span> mycmp(self.obj, other.obj) != <span class=number>0</span></span><br><span class=line>    <span class=keyword>return</span> K</span><br></pre></td></tr></table></figure></p><p>当需要将<code>cmp</code>转化为<code>key</code>时，只需要：<br><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted([<span class=number>5</span>, <span class=number>2</span>, <span class=number>4</span>, <span class=number>1</span>, <span class=number>3</span>], key=cmp_to_key(reverse_numeric))</span><br><span class=line>[<span class=number>5</span>, <span class=number>4</span>, <span class=number>3</span>, <span class=number>2</span>, <span class=number>1</span>]</span><br></pre></td></tr></table></figure></p><p>从python2.7，<code>cmp_to_key()</code>函数被增加到了<code>functools</code>模块中。</p><h2 id=其他注意事项><a href=#其他注意事项 class=headerlink title=其他注意事项></a>其他注意事项</h2><ul><li>对需要进行区域相关的排序时，可以使用locale.strxfrm()作为key函数，或者使用local.strcoll()作为cmp函数。</li><li><p>reverse参数任然保持了排序的稳定性，有趣的时，同样的效果可以使用reversed()函数两次来实现：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>data = [(<span class=string>'red'</span>, <span class=number>1</span>), (<span class=string>'blue'</span>, <span class=number>1</span>), (<span class=string>'red'</span>, <span class=number>2</span>), (<span class=string>'blue'</span>, <span class=number>2</span>)]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span><span class=keyword>assert</span> sorted(data, reverse=<span class=keyword>True</span>) == list(reversed(sorted(reversed(data))))</span><br></pre></td></tr></table></figure></li><li><p>其实排序在内部是调用元素的<code>__cmp__</code>来进行的，所以我们可以为元素类型增加<code>__cmp__</code>方法使得元素可比较，例如：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>Student.__lt__ = <span class=keyword>lambda</span> self, other: self.age &lt; other.age</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(student_objects)</span><br><span class=line>[(<span class=string>'dave'</span>, <span class=string>'B'</span>, <span class=number>10</span>), (<span class=string>'jane'</span>, <span class=string>'B'</span>, <span class=number>12</span>), (<span class=string>'john'</span>, <span class=string>'A'</span>, <span class=number>15</span>)]</span><br></pre></td></tr></table></figure></li><li><p>key函数不仅可以访问需要排序元素的内部数据，还可以访问外部的资源，例如，如果学生的成绩是存储在<code>dict</code>中的，则可以使用此<code>dict</code>来对学生名字的<code>list</code>排序，如下：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=meta>&gt;&gt;&gt; </span>students = [<span class=string>'dave'</span>, <span class=string>'john'</span>, <span class=string>'jane'</span>]</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>newgrades = &#123;<span class=string>'john'</span>: <span class=string>'F'</span>, <span class=string>'jane'</span>:<span class=string>'A'</span>, <span class=string>'dave'</span>: <span class=string>'C'</span>&#125;</span><br><span class=line><span class=meta>&gt;&gt;&gt; </span>sorted(students, key=newgrades.__getitem__)</span><br><span class=line>[<span class=string>'jane'</span>, <span class=string>'dave'</span>, <span class=string>'john'</span>]</span><br></pre></td></tr></table></figure></li><li><p>当你需要在处理数据的同时进行排序的话，<code>sort()</code>,<code>sorted()</code>或<code>bisect.insort()</code>不是最好的方法。在这种情况下，可以使用<code>heap</code>，<code>red-black tree</code>或<code>treap</code>。</p></li></ul></div><div><div id=wechat_subscriber style="display: block； padding: 10px 0; margin: 20px auto; width: 100%; text-align: center"><img id=wechat_subscriber_qcode src=/images/qrcode_vitostack.jpg alt="Vito wechat" style="width: 200px; max-width: 100%;"><div>欢迎关注我的公众号：VitoStackBlog。</div></div></div><div></div><footer class=post-footer><div class=post-tags><a href="/tags/python/" rel=tag>#python</a></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href="/2016/05/05/python-map-reduce-on-hadoop/" rel=next title=Hadoop上跑MapReduce的Python示例><i class="fa fa-chevron-left"></i> Hadoop上跑MapReduce的Python示例</a></div><div class="post-nav-prev post-nav-item"><a href="/2016/05/06/hadoop-failed-task-and-killed-task/" rel=prev title="hadoop failed task和killed task介绍">hadoop failed task和killed task介绍 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class=post-spread><div class="ds-share flat" data-thread-key="2016/05/06/python-sort-highly-advance/" data-title="python排序sort sorted高级排序技巧" data-content data-url="http://www.vitostack.com/2016/05/06/python-sort-highly-advance/"><div class=ds-share-inline><ul class=ds-share-icons-16><li data-toggle=ds-share-icons-more><a class=ds-more href=javascript:void(0);>分享到：</a></li><li><a class=ds-weibo href=javascript:void(0); data-service=weibo>微博</a></li><li><a class=ds-qzone href=javascript:void(0); data-service=qzone>QQ空间</a></li><li><a class=ds-qqt href=javascript:void(0); data-service=qqt>腾讯微博</a></li><li><a class=ds-wechat href=javascript:void(0); data-service=wechat>微信</a></li></ul><div class=ds-share-icons-more></div></div></div></div></div></div><div class=comments id=comments><div class=ds-thread data-thread-key="2016/05/06/python-sort-highly-advance/" data-title="python排序sort sorted高级排序技巧" data-url="http://www.vitostack.com/2016/05/06/python-sort-highly-advance/"></div></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/images/avatar.jpg alt=Vito><p class=site-author-name itemprop=name>Vito</p><p class="site-description motion-element" itemprop=description>Life is short, why you become a developer?</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/archives><span class=site-state-item-count>9</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><span class=site-state-item-count>4</span> <span class=site-state-item-name>分类</span></div><div class="site-state-item site-state-tags"><a href=/tags><span class=site-state-item-count>12</span> <span class=site-state-item-name>标签</span></a></div></nav><div class="feed-link motion-element"><a href=/atom.xml rel=alternate><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/Vito2015 target=_blank title=GitHub><i class="fa fa-github"></i> GitHub</a></span> <span class=links-of-author-item><a href=http://weibo.com/1955345990 target=_blank title=Weibo><i class="fa fa-weibo"></i> Weibo</a></span> <span class=links-of-author-item><a href="http://www.cnblogs.com/Vito2008/" target=_blank title=CnBlogs><i class="fa fa-cnblogs"></i> CnBlogs</a></span> <span class=links-of-author-item><a href=https://segmentfault.com/u/vitostack target=_blank title=SegmentFault><i class="fa fa-segmentfault"></i> SegmentFault</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i> Links</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=http://blog.vitostack.com title="Vito's lifeblog" target=_blank>Vito's lifeblog</a></li><li class=links-of-blogroll-item><a href="http://opiece.me/" title=Chillax target=_blank>Chillax</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#基础货><span class=nav-number>1.</span> <span class=nav-text>基础货</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#排序基础><span class=nav-number>1.1.</span> <span class=nav-text>排序基础</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#key参数-函数><span class=nav-number>1.2.</span> <span class=nav-text>key参数/函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#高级技巧><span class=nav-number>2.</span> <span class=nav-text>高级技巧</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Operator-模块函数><span class=nav-number>2.1.</span> <span class=nav-text>Operator 模块函数</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#升序和降序><span class=nav-number>2.2.</span> <span class=nav-text>升序和降序</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#排序的稳定性和复杂排序><span class=nav-number>2.3.</span> <span class=nav-text>排序的稳定性和复杂排序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#最老土的排序方法-DSU><span class=nav-number>3.</span> <span class=nav-text>最老土的排序方法-DSU</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#其他语言普遍使用的排序方法-cmp函数><span class=nav-number>4.</span> <span class=nav-text>其他语言普遍使用的排序方法-cmp函数</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#其他注意事项><span class=nav-number>5.</span> <span class=nav-text>其他注意事项</span></a></li></ol></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright>&copy; <span itemprop=copyrightYear>2016</span> <span class=with-love><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>Vito</span></div><div class=powered-by>由 <a class=theme-link href=http://hexo.io>Hexo</a> 强力驱动</div><div class=theme-info>主题 - <a class=theme-link href=https://github.com/iissnan/hexo-theme-next>NexT.Mist</a></div><div class=busuanzi-count><script async src=https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv><i class="fa fa-user"></i><span class=busuanzi-value id=busuanzi_value_site_uv></span></span> <span class=site-pv><i class="fa fa-eye"></i><span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i></div></div><script type=text/javascript>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script><script type=text/javascript src="/vendors/jquery/index.js?v=2.1.3"></script><script type=text/javascript src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type=text/javascript src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type=text/javascript src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type=text/javascript src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type=text/javascript src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type=text/javascript src="/js/src/utils.js?v=5.0.1"></script><script type=text/javascript src="/js/src/motion.js?v=5.0.1"></script><script type=text/javascript src="/js/src/scrollspy.js?v=5.0.1"></script><script type=text/javascript src="/js/src/post-details.js?v=5.0.1"></script><script type=text/javascript src="/js/src/bootstrap.js?v=5.0.1"></script><script type=text/javascript>
    var duoshuoQuery = {short_name:"code-vitostack"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script><script src=https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js></script><script>AV.initialize("LOpG8n71H2qRPltNTFHErGd6-gzGzoHsz", "dxEsNEnda31HqXSQEUq9YjKN");</script><script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script><script type=text/javascript async src=//push.zhanzhang.baidu.com/push.js>
</script></body></html>